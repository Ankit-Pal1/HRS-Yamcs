<ng-container *ngIf="!(selectedCommand$ | async)">
  <div class="wrapper mat-typography">
    <form [formGroup]="selectCommandForm" class="ya-form">
      <h2>Select command</h2>
      <div class="command-table-wrapper">
        <app-command-selector #commandSelector formControlName="command"></app-command-selector>
      </div>
    </form>
  </div>
  <div class="footer mat-typography">
    <mat-toolbar>
      <mat-toolbar-row>
        <button class="ya-button" mat-dialog-close>CANCEL</button>
      </mat-toolbar-row>
    </mat-toolbar>
  </div>
</ng-container>

<ng-container *ngIf="selectedCommand$ | async as command">
  <div class="wrapper mat-typography">
    <div class="command-detail">
      <ng-container *ngIf="command.qualifiedName | spaceSystemName as spaceSystem">
        <app-text-action [padding]="false" (click)="returnToList(spaceSystem)">
          {{ spaceSystem }}
        </app-text-action>
      </ng-container>
      <h2>{{ command.name }}</h2>
      <app-command-form #commandForm
                        [command]="command"
                        [templateProvider]="templateProvider">
      </app-command-form>
      <form [formGroup]="stackOptionsForm" class="ya-form" [ngClass]="this.stackOptionsForm.disabled && 'disabled'">
        <p>&nbsp;</p>
        <h3>Command stack options</h3>
        <p *ngIf="format !== 'json'" style="color: #CC0000">These options are only available for JSON fomatted
          command stacks</p>
        <div class="label">
          Advance stack on acknowledgement
          <app-help dialogTitle="Advance On Acknowledgement">
            Acknowledgement to wait for to advance to the next command in the stack.
            If a delay is also specified, the next command is exectuded after this time from the recieval of the
            acknowledgement.<br>
            (Unset uses the global value for the stack or the default: Queued)
          </app-help>
          <br>
          <select formControlName="advanceOnAckDropDown">
            <option value="">Inherit</option>
            <option *ngFor="let ack of predefinedAcksArray" [value]="ack.name">{{ ack.verboseName }}</option>
            <option value="custom">Custom</option>
          </select>
          <input type="text" formControlName="advanceOnAckCustom"
                 *ngIf="stackOptionsForm.get('advanceOnAckDropDown')?.value === 'custom'">
        </div>
        <div class="label">
          Advance stack on delay (ms)
          <app-help dialogTitle="Advance On Delay">
            Delay to wait for to advance to the next command in the stack.
            If an acknowledgements also specified, the next command is exectuded after this time from the recieval of
            the acknowledgement.<br>
            (Unset uses the global value for the stack or the default: 0)
          </app-help>
          <br>
          <input type="number" formControlName="advanceOnDelay" placeholder="Inherit">
        </div>
      </form>
    </div>
  </div>
  <div class="footer mat-typography">
    <mat-toolbar>
      <mat-toolbar-row>
        <button class="ya-button" mat-dialog-close>CANCEL</button>&nbsp;&nbsp;
        <button class="ya-button primary"
                (click)="handleOK()"
                [disabled]="!commandForm.form.valid">
          <!-- TODO: disabled throws a "ExpressionChangedAfterItHasBeenCheckedError", potentially needs fix -->
          {{ okLabel }}</button>
      </mat-toolbar-row>
    </mat-toolbar>
  </div>
</ng-container>
