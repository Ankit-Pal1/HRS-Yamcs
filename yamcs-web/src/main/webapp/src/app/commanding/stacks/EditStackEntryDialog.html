<ng-container *ngIf="!(selectedCommand$ | async)">
  <div class="wrapper mat-typography">
    <form [formGroup]="selectCommandForm" class="ya-form">
      <h2>Select command</h2>
      <div class="command-table-wrapper">
        <app-command-selector #commandSelector formControlName="command"></app-command-selector>
      </div>
    </form>
  </div>
  <div class="footer mat-typography">
    <mat-toolbar>
      <mat-toolbar-row>
        <button class="ya-button" mat-dialog-close>CANCEL</button>
      </mat-toolbar-row>
    </mat-toolbar>
  </div>
</ng-container>

<ng-container *ngIf="selectedCommand$ | async as command">
  <div class="wrapper mat-typography">
    <div class="command-detail">
      <ng-container *ngIf="command.qualifiedName | spaceSystemName as spaceSystem">
        <app-text-action [padding]="false" (click)="returnToList(spaceSystem)">
          {{ spaceSystem }}
        </app-text-action>
      </ng-container>
      <h2>{{ command.name }}</h2>
      <app-command-form #commandForm
                        [command]="command"
                        [templateProvider]="templateProvider">
      </app-command-form>
      <form [formGroup]="stackOptionsForm" class="ya-form" [ngClass]="this.stackOptionsForm.disabled && 'disabled'">
        <p>&nbsp;</p>
        <h3>Stack advancement</h3>
        <p *ngIf="format !== 'json'" style="color: #CC0000">These options are only available for JSON formatted command stacks</p>
        <div class="label">
          Advance when
          <app-advance-ack-help [verifiers]="verifierAcknowledgments"
                                [extra]="extraAcknowledgments">
          </app-advance-ack-help>
          <br>
          <div style="display: flex; align-items: flex-start;">
            <app-select #ackSelect
                        [options]="ackOptions"
                        formControlName="advancementAckDropDown"
                        emptyOption="Inherit">
            </app-select>
            <input type="text" formControlName="advancementAckCustom"
                  *ngIf="stackOptionsForm.get('advancementAckDropDown')?.value === 'custom'"
                  style="width: 200px; margin-left: -1px">
          </div>
        </div>
        <br>
        <div class="label">
          Wait (ms)
          <app-help dialogTitle="Wait time">
            <p>
              Wait time before advancing to the next command in the stack.
            </p>
            <p>
              This triggers after successful acknowledgment.
            </p>
          </app-help>
          <br>
          <input type="number" formControlName="advancementWait" placeholder="Inherit" step="1000" min="0">
        </div>
      </form>
    </div>
  </div>
  <div class="footer mat-typography">
    <mat-toolbar>
      <mat-toolbar-row>
        <button class="ya-button" mat-dialog-close>CANCEL</button>&nbsp;&nbsp;
        <button class="ya-button primary"
                (click)="handleOK()"
                [disabled]="!commandForm.form.valid">
          <!-- TODO: disabled throws a "ExpressionChangedAfterItHasBeenCheckedError", potentially needs fix -->
          {{ okLabel }}</button>
      </mat-toolbar-row>
    </mat-toolbar>
  </div>
</ng-container>
